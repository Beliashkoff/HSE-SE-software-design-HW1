# Zoo ERP — Go, SOLID, DI, Tests

Учебный мини-проект: учёт животных и вещей, приёмка через ветклинику, отчёты по корму и контактному зоопарку. Архитектура — слоистая, с соблюдением SOLID, In-Memory репозитории, DI-контейнер (Uber `dig`), юнит-тесты.

## Как запустить

```bash
# 1) инициализировать модуль
# go mod init zoo-erp

# 2) подтяни зависимости
go mod tidy

# 3) запуск консольного приложения
go run ./cmd/zoo

# 4) тесты и покрытие
go test ./... -cover
```
Что умеет приложение
Добавлять животных (Rabbit, Monkey, Tiger, Wolf) и вещи (Table, Computer).

Проверять здоровье новых животных в ветклинике.

Считать суммарный корм (кг/сутки) по всем животным.

Формировать список животных для контактного зоопарка (травоядные с добротой > 5).

Выводить инвентаризацию: наименование + инвентарный номер у животных и вещей.

Архитектура 
```
cmd/zoo          — консоль, только ввод/вывод
internal/app     — composition root (DI, сборка контейнера)
internal/services— бизнес-сценарии (ZooService, VetClinic, NumberGen)
internal/domain  — предметная область (Animal/Herbivore/Predator, Thing; интерфейсы Eater/InventoryItem)
internal/repo    — in-memory репозитории с уникальностью номеров
```
SOLID — где что
S (Single Responsibility): UI, сервисы, репо, домен — каждый слой со своей ролью.

O (Open/Closed): новые виды животных/вещей добавляются без правок сервисов — работают через интерфейсы Eater/InventoryItem.

L (Liskov): Rabbit/Tiger/... подставимы как Eater/InventoryItem.

I (Interface Segregation): узкие интерфейсы (Eater, InventoryItem), локальный kinder в сервисе.

D (Dependency Inversion): сервис зависит от абстракций (AnimalRepo, ThingRepo, VetClinic), конкретики даёт DI-контейнер.

DI-контейнер
internal/app/container.go — регистрирует провайдеры (NewAnimalMem, NewThingMem, NewSimpleVet, NewSeq, NewZoo) и собирает зависимости по типам (go.uber.org/dig).

Репозитории и потокобезопасность
Структура хранения: срез + индекс-карта номер + позиция.

Атомарность : проверка+вставка под sync.Mutex.

All() возвращает копию — внешние изменения не ломают внутреннее состояние.

Уникальность номеров: проверяется в репозитории; дополнительно используется единый NumberGen.

Валидации
Имя: TrimSpace, не пустое.

Food/Number: не отрицательные.

Kindness: в диапазоне [0..10].

Ветклиника: простая логика, можно подключить DB или http.

Как расширять
Добавить вид животного: новый тип в domain, сервисы трогать не надо.

Изменить генерацию номеров: другая реализация NumberGen, DI провайдера — и всё.

Перейти на БД: реализовать AnimalRepo/ThingRepo поверх БД, зарегистрировать их вместо in-memory в container.go.

Добавить HTTP-API: новый cmd/api, адаптер HTTP - ZooService.

Примечания
Интерфейсы названы по роли (Eater, InventoryItem) — Go так принято тут. Метод Food() понимается как кг/сутки (указано в GoDoc).

Тесты покрывают ключевые ветви: отказ ветклиники, уникальность номеров, расчёт корма, фильтр контакт-зоопарка.

# Подробнее для тестов
## Быстрый старт
#### Запустить все тесты во всех пакетах (с кратким покрытием по пакетам)
go test ./... -cover

#### Подробный вывод (имена и статусы тестов)
go test ./... -v

Что означают строки вроде:
ok   github.com/.../internal/repo     (cached)  coverage: 80.6% of statements

ok — пакет прошёл тесты.
(cached) — результат взят из кеша (повторный запуск без изменений).
coverage: 80.6% — доля исполнимых строк пакета, покрытых тестами.

## Сводное покрытие  + HTML-отчёт
#### 1) Сформировать профиль покрытия
`go test ./... -coverprofile=cover.out`

#### 2) Посмотреть сводку по функциям
`go tool cover -func=cover.out`

#### 3) Открыть интерактивную карту покрытия в браузере
`go tool cover -html=cover.out`

## Запуск отдельных пакетов/тестов
#### Только сервисы
`go test ./internal/services -v -cover`

#### Только репозитории с детектором гонок
`go test ./internal/repo -race -v`

#### Один конкретный тест (по префиксу имени)
` go test ./internal/services -run TestContactZoo_Boundary -v` 
